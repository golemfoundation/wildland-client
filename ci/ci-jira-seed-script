#!/bin/bash
# SEEDS JIRA PROJECT WITH DATA REQUIRED BY INTEGRATION TESTS FOR WILDLAND'S JIRA PLUGIN
# The script requires four parameters: jira username and token, workspace url, either id or key of project to seed

function Help()
{
   # Display Help
   echo
   echo "A script to seed jira project with data required by integration tests for wildland's jira plugin"
   echo
   echo "Usage: $(basename "$0") [ -h | -u username -t token [ -i project_id | -k project_key ] -w workspace_api_url ]"
   echo "options:"
   echo "h     Print this Help."
   echo "u     Jira username."
   echo "t     Personal access token generated by Jira."
   echo "i     Id of the Jira project to seed. Can be find by querying <your workspace url>/rest/api/{2,3}/project"
   echo "k     Key of the Jira project to seed."
   echo "w     Url of the v2 REST endpoint of the Jira workspace."
   echo
}

# A POSIX variable
OPTIND=1         # Reset in case getopts has been used previously in the shell.

# Initialize our own variables:
username=""
token=""
project_id=""
project_key=""
url=""

while getopts "hu:t:i:k:w:" option; do
   case $option in
      h|\?)
        Help
        exit 0;;
      u) username=$OPTARG ;;
      t) token=$OPTARG ;;
      i) project_id=$OPTARG ;;
      k) project_key=$OPTARG ;;
      w) url=$OPTARG ;;
     esac
done


if [ -z "$username" ]; then
  echo "Username cannot be empty"
  exit 1
fi
if [ -z "$token" ]; then
  echo "Token cannot be empty"
  exit 1
fi
if [ -n "$project_id" ]; then
  project="{\"id\":\"$project_id\"}"
elif [ -n "$project_key" ]; then
  project="{\"key\":\"$project_key\"}"
else
  echo "Either project id or key cannot be empty"
  exit 1
fi
if [ -z "$url" ]; then
  echo "Workspace url cannot be empty"
  exit 1
fi

function SubmitIssues()
{
  if [ "${url: -1}" != '/' ]; then
    url="$url/" ;
  fi

  curl --location --request POST "$url/issue/bulk" \
    -u "$username:$token" \
    --header 'Content-Type: application/json' \
    --data-raw "{\"issueUpdates\":[{\"update\":{},\"fields\":{\"summary\":\"Aegypius occipitalis\",\"description\":\"Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Nulla dapibus dolor vel est.\",\"project\":$project,\"issuetype\":{\"name\":\"Bug\"},\"labels\":[\"bugfix\",\"followup\"]}},{\"update\":{},\"fields\":{\"summary\":\"Pseudalopex gymnocercus\",\"description\":\"Vivamus in felis eu sapien cursus vestibulum.\",\"project\":$project,\"issuetype\":{\"name\":\"Task\"},\"labels\":[\"blitz_test\",\"actualization\"]}},{\"update\":{},\"fields\":{\"summary\":\"Heloderma horridum\",\"description\":\"Nulla nisl. Nunc nisl.\",\"project\":$project,\"issuetype\":{\"name\":\"Task\"},\"labels\":[\"welcome\",\"Refinamento\"]}},{\"update\":{},\"fields\":{\"summary\":\"Larus fuliginosus\",\"description\":\"Vivamus vestibulum sagittis sapien. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.\",\"project\":$project,\"issuetype\":{\"name\":\"Bug\"},\"labels\":[\"backend\",\"Validacao\"]}},{\"update\":{},\"fields\":{\"summary\":\"Naja haje\",\"description\":\"Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Proin risus.\",\"project\":$project,\"issuetype\":{\"name\":\"Task\"},\"labels\":[\"frontend\",\"Documentacao\"]}},{\"update\":{},\"fields\":{\"summary\":\"Uraeginthus granatina\",\"description\":\"Etiam faucibus cursus urna. Ut tellus.\",\"project\":$project,\"issuetype\":{\"name\":\"Task\"},\"labels\":[\"bugfix\",\"Alinhamento\"]}},{\"update\":{},\"fields\":{\"summary\":\"Bassariscus astutus\",\"description\":\"In quis justo. Maecenas rhoncus aliquam lacus.\",\"project\":$project,\"issuetype\":{\"name\":\"Bug\"},\"labels\":[\"blitz_test\",\"estrategia\"]}},{\"update\":{},\"fields\":{\"summary\":\"Nannopterum harrisi\",\"description\":\"Sed ante. Vivamus tortor.\",\"project\":$project,\"issuetype\":{\"name\":\"Task\"},\"labels\":[\"welcome\",\"followup\"]}},{\"update\":{},\"fields\":{\"summary\":\"Cygnus buccinator\",\"description\":\"Proin eu mi.\",\"project\":$project,\"issuetype\":{\"name\":\"Task\"},\"labels\":[\"backend\",\"actualization\"]}},{\"update\":{},\"fields\":{\"summary\":\"Geochelone elephantopus\",\"description\":\"Mauris enim leo, rhoncus sed, vestibulum sit amet, cursus id, turpis.\",\"project\":$project,\"issuetype\":{\"name\":\"Bug\"},\"labels\":[\"frontend\",\"Refinamento\"]}},{\"update\":{},\"fields\":{\"summary\":\"Anser anser\",\"description\":\"Donec semper sapien a libero.\",\"project\":$project,\"issuetype\":{\"name\":\"Task\"},\"labels\":[\"bugfix\",\"Validacao\"]}},{\"update\":{},\"fields\":{\"summary\":\"Psophia viridis\",\"description\":\"Morbi ut odio. Cras mi pede, malesuada in, imperdiet et, commodo vulputate, justo.\",\"project\":$project,\"issuetype\":{\"name\":\"Task\"},\"labels\":[\"blitz_test\",\"Documentacao\"]}},{\"update\":{},\"fields\":{\"summary\":\"Phaethon aethereus\",\"description\":\"Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Nulla dapibus dolor vel est. Donec odio justo, sollicitudin ut, suscipit a, feugiat et, eros.\",\"project\":$project,\"issuetype\":{\"name\":\"Bug\"},\"labels\":[\"welcome\",\"Alinhamento\"]}}]}"
}

SubmitIssues
